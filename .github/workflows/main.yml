# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "master" branch
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
    - name: set up JDK 11
      uses: actions/setup-java@v1
      with:
        java-version: 11
    - name: build release 
      run: ./gradlew assembleRelease
    
      
    - name: upload artifact to Firebase App Distribution
      uses: wzieba/Firebase-Distribution-Github-Action@v1
    - name: Fetch credential file from secrets
      id: fetch_credential_file
      uses: timheuer/base64-to-file@v1
      with:
          encodedString: ${{ secrets.CREDENTIAL_FILE }}
          fileName: 'credential_file.json'
    - name: Move credential file to repository location
      run: mv ${{ steps.fetch_credential_file.outputs.filePath }} /home/runner/work/Firebase-Distribution-Github-Action/Firebase-Distribution-Github-Action/
    - name: login 
      run: firebase login
    - name: Upload artifact to Firebase Distribution using credential file
      with:
          appId: ${{secrets.FIREBASE_APP_ID}}
          groups: Testers
          releaseNotesFile: README.md
          file: ApiDemos-debug.apk
          debug: true
          serviceCredentialsFile: credential_file.json
